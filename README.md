# üõí Mixi Shop - H·ªá th·ªëng Qu·∫£n L√Ω B√°n H√†ng (Microservices Architecture)

## üìå M·ª•c ti√™u

Ph√°t tri·ªÉn h·ªá th·ªëng qu·∫£n l√Ω b√°n h√†ng theo ki·∫øn tr√∫c **Microservices**, v·ªõi m·ª•c ti√™u:

- T√°ch bi·ªát logic nghi·ªáp v·ª• gi·ªØa c√°c domain: S·∫£n ph·∫©m, ƒê∆°n h√†ng, Kh√°ch h√†ng.
- D·ªÖ d√†ng m·ªü r·ªông, b·∫£o tr√¨, tri·ªÉn khai ƒë·ªôc l·∫≠p t·ª´ng service.
- ƒê·∫£m b·∫£o hi·ªáu su·∫•t cao v√† kh·∫£ nƒÉng m·ªü r·ªông linh ho·∫°t.

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng

![mixi-shop-microservice](https://github.com/user-attachments/assets/75b8b0a6-f393-4ce6-a224-90dc2155a4d5)

### C√°c th√†nh ph·∫ßn ch√≠nh
- **API Gateway**: L√† c·∫ßu n·ªëi duy nh·∫•t gi·ªØa client v√† c√°c microservice. N√≥ x·ª≠ l√Ω ƒë·ªãnh tuy·∫øn, gom d·ªØ li·ªáu t·ª´ nhi·ªÅu service, ki·ªÉm tra x√°c th·ª±c...
- **Frontend**: D·ª± ki·∫øn x√¢y d·ª±ng b·∫±ng **React + Vite** ƒë·ªÉ ƒë·∫£m b·∫£o hi·ªáu su·∫•t ph√°t tri·ªÉn nhanh, hi·ªán ƒë·∫°i.

## üß∞ C√¥ng ngh·ªá s·ª≠ d·ª•ng

- **Node.js** + **Express.js**: X√¢y d·ª±ng c√°c backend service.
- **MongoDB**: C∆° s·ªü d·ªØ li·ªáu NoSQL, m·ªói service c√≥ 1 DB ri√™ng bi·ªát.
- **Docker & Docker Compose**: Tri·ªÉn khai, container h√≥a c√°c service.
- **RESTful API**: Chu·∫©n giao ti·∫øp gi·ªØa c√°c service.
- **dotenv**: C·∫•u h√¨nh bi·∫øn m√¥i tr∆∞·ªùng.
- **React + Vite** _(frontend - ƒëang tri·ªÉn khai)_

## üìÅ C·∫•u tr√∫c th∆∞ m·ª•c

```
mixi-shop-be/
‚îú‚îÄ‚îÄ api-gateway/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ       ‚îî‚îÄ‚îÄ routes/
‚îÇ           ‚îî‚îÄ‚îÄ gateway.routes.js
‚îÇ
‚îú‚îÄ‚îÄ product-service/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ product.model.js
‚îÇ       ‚îú‚îÄ‚îÄ controllers/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ productController.js
‚îÇ       ‚îî‚îÄ‚îÄ routes/
‚îÇ           ‚îî‚îÄ‚îÄ product.routes.js
‚îÇ
‚îú‚îÄ‚îÄ order-service/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ order.model.js
‚îÇ       ‚îú‚îÄ‚îÄ controllers/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ orderController.js
‚îÇ       ‚îî‚îÄ‚îÄ routes/
‚îÇ           ‚îî‚îÄ‚îÄ order.routes.js
‚îÇ
‚îú‚îÄ‚îÄ customer-service/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ customer.model.js
‚îÇ       ‚îú‚îÄ‚îÄ controllers/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ customerController.js
‚îÇ       ‚îî‚îÄ‚îÄ routes/
‚îÇ           ‚îî‚îÄ‚îÄ customer.routes.js
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

## üõ°Ô∏è Resilience Patterns

### 1. Circuit Breaker Pattern

#### M·ª•c ƒë√≠ch
- NgƒÉn ch·∫∑n l·ªói lan truy·ªÅn trong h·ªá th·ªëng microservices
- X·ª≠ l√Ω gracefully khi service b·ªã l·ªói ho·∫∑c qu√° t·∫£i
- Cho ph√©p service ph·ª•c h·ªìi m√† kh√¥ng b·ªã qu√° t·∫£i b·ªüi requests

#### Tri·ªÉn khai
```javascript
const circuitBreaker = new CircuitBreaker(async (req) => {
  const response = await axios.get(serviceUrl);
  return response.data;
}, {
  timeout: 3000,                    // Th·ªùi gian timeout cho m·ªói request
  errorThresholdPercentage: 50,     // % l·ªói ƒë·ªÉ k√≠ch ho·∫°t circuit breaker
  resetTimeout: 30000,              // Th·ªùi gian ch·ªù tr∆∞·ªõc khi th·ª≠ l·∫°i
  volumeThreshold: 10,              // S·ªë l∆∞·ª£ng requests t·ªëi thi·ªÉu tr∆∞·ªõc khi ƒë√°nh gi√°
});
```

#### Tr·∫°ng th√°i
1. **CLOSED** (B√¨nh th∆∞·ªùng)
   - Requests ƒë∆∞·ª£c chuy·ªÉn ti·∫øp b√¨nh th∆∞·ªùng
   - Theo d√µi t·ª∑ l·ªá l·ªói v√† th·ªùi gian ph·∫£n h·ªìi
   - Chuy·ªÉn sang OPEN n·∫øu v∆∞·ª£t ng∆∞·ª°ng l·ªói

2. **OPEN** (Ng·∫Øt)
   - T·ª´ ch·ªëi requests ngay l·∫≠p t·ª©c
   - Tr·∫£ v·ªÅ fallback response ho·∫∑c th√¥ng b√°o l·ªói
   - Chuy·ªÉn sang HALF-OPEN sau resetTimeout

3. **HALF-OPEN** (Th·ª≠ nghi·ªám)
   - Cho ph√©p m·ªôt s·ªë requests th·ª≠ nghi·ªám
   - ƒê√°nh gi√° k·∫øt qu·∫£ ƒë·ªÉ quy·∫øt ƒë·ªãnh chuy·ªÉn v·ªÅ CLOSED hay OPEN
   - Gi·ªõi h·∫°n s·ªë l∆∞·ª£ng requests th·ª≠ nghi·ªám

### 2. Retry Pattern

#### M·ª•c ƒë√≠ch
- X·ª≠ l√Ω l·ªói t·∫°m th·ªùi trong network ho·∫∑c service
- TƒÉng kh·∫£ nƒÉng th√†nh c√¥ng c·ªßa request
- Tr√°nh ·∫£nh h∆∞·ªüng ƒë·∫øn tr·∫£i nghi·ªám ng∆∞·ªùi d√πng

#### Tri·ªÉn khai
```javascript
const retry = new Retry(async (req) => {
  const response = await axios.get(serviceUrl);
  return response.data;
}, {
  retries: 3,                      // S·ªë l·∫ßn th·ª≠ l·∫°i t·ªëi ƒëa
  minTimeout: 1000,                // Th·ªùi gian ch·ªù t·ªëi thi·ªÉu gi·ªØa c√°c l·∫ßn th·ª≠
  maxTimeout: 5000,                // Th·ªùi gian ch·ªù t·ªëi ƒëa
  factor: 2,                       // H·ªá s·ªë tƒÉng th·ªùi gian ch·ªù (exponential backoff)
  randomize: true,                 // Th√™m ƒë·ªô nhi·ªÖu ng·∫´u nhi√™n
});
```

#### Chi·∫øn l∆∞·ª£c Retry
1. **Immediate Retry**
   - Th·ª≠ l·∫°i ngay l·∫≠p t·ª©c
   - Ph√π h·ª£p v·ªõi l·ªói t·∫°m th·ªùi ng·∫Øn

2. **Fixed Delay**
   - Ch·ªù m·ªôt kho·∫£ng th·ªùi gian c·ªë ƒë·ªãnh gi·ªØa c√°c l·∫ßn th·ª≠
   - Tr√°nh qu√° t·∫£i service

3. **Exponential Backoff**
   - TƒÉng th·ªùi gian ch·ªù theo c·∫•p s·ªë nh√¢n
   - Gi·∫£m t·∫£i cho service khi c√≥ v·∫•n ƒë·ªÅ

4. **Exponential Backoff with Jitter**
   - Th√™m ƒë·ªô nhi·ªÖu ng·∫´u nhi√™n
   - Tr√°nh "thundering herd" khi nhi·ªÅu clients retry c√πng l√∫c

### 3. Rate Limiter Pattern

#### M·ª•c ƒë√≠ch
- B·∫£o v·ªá service kh·ªèi qu√° t·∫£i
- ƒê·∫£m b·∫£o c√¥ng b·∫±ng gi·ªØa c√°c clients
- NgƒÉn ch·∫∑n DOS attacks

#### Tri·ªÉn khai
```javascript
const rateLimiter = new RateLimiter({
  windowMs: 15 * 60 * 1000,        // C·ª≠a s·ªï th·ªùi gian (15 ph√∫t)
  max: 100,                        // S·ªë requests t·ªëi ƒëa trong c·ª≠a s·ªï
  message: 'Qu√° nhi·ªÅu requests, vui l√≤ng th·ª≠ l·∫°i sau.',
  standardHeaders: true,           // Tr·∫£ v·ªÅ RateLimit headers
  legacyHeaders: false,           // Disable X-RateLimit headers
});
```

#### Thu·∫≠t to√°n
1. **Fixed Window**
   - Gi·ªõi h·∫°n s·ªë requests trong kho·∫£ng th·ªùi gian c·ªë ƒë·ªãnh
   - Reset counter khi h·∫øt window
   - ƒê∆°n gi·∫£n, d·ªÖ implement

2. **Sliding Window**
   - C·ª≠a s·ªï th·ªùi gian di chuy·ªÉn
   - Ch√≠nh x√°c h∆°n Fixed Window
   - Tr√°nh spike t·∫°i ranh gi·ªõi window

3. **Token Bucket**
   - Th√™m tokens theo t·ªëc ƒë·ªô c·ªë ƒë·ªãnh
   - M·ªói request ti√™u th·ª• m·ªôt token
   - Cho ph√©p burst traffic trong gi·ªõi h·∫°n

4. **Leaky Bucket**
   - X·ª≠ l√Ω requests v·ªõi t·ªëc ƒë·ªô c·ªë ƒë·ªãnh
   - Queue requests v∆∞·ª£t qu√° gi·ªõi h·∫°n
   - ƒê·∫£m b·∫£o t·∫£i ƒë·ªÅu cho backend

### 4. Time Limiter Pattern

#### M·ª•c ƒë√≠ch
- NgƒÉn ch·∫∑n requests ch·∫≠m chi·∫øm t√†i nguy√™n
- ƒê·∫£m b·∫£o responsive cho h·ªá th·ªëng
- Tr√°nh deadlock v√† resource leaks

#### Tri·ªÉn khai
```javascript
const timeLimiter = new TimeLimiter({
  timeout: 5000,                   // Th·ªùi gian timeout (ms)
  onTimeout: async (req) => {
    // X·ª≠ l√Ω khi request timeout
    return { error: 'Request timeout' };
  },
  shouldTimeout: (req) => {
    // Logic quy·∫øt ƒë·ªãnh c√≥ √°p d·ª•ng timeout
    return true;
  }
});
```

#### Chi·∫øn l∆∞·ª£c Timeout
1. **Fixed Timeout**
   - Th·ªùi gian c·ªë ƒë·ªãnh cho m·ªçi request
   - ƒê∆°n gi·∫£n, d·ªÖ qu·∫£n l√Ω

2. **Dynamic Timeout**
   - ƒêi·ªÅu ch·ªânh timeout d·ª±a tr√™n lo·∫°i request
   - Ph√π h·ª£p v·ªõi c√°c operation ph·ª©c t·∫°p

3. **Adaptive Timeout**
   - T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh d·ª±a tr√™n ƒëi·ªÅu ki·ªán h·ªá th·ªëng
   - T·ªëi ∆∞u h√≥a performance

#### X·ª≠ l√Ω Timeout
1. **Cancel Operation**
   - H·ªßy request khi timeout
   - Gi·∫£i ph√≥ng t√†i nguy√™n

2. **Partial Response**
   - Tr·∫£ v·ªÅ k·∫øt qu·∫£ m·ªôt ph·∫ßn n·∫øu c√≥
   - Th√¥ng b√°o cho client v·ªÅ t√¨nh tr·∫°ng timeout

3. **Fallback Strategy**
   - Cung c·∫•p d·ªØ li·ªáu cached ho·∫∑c default
   - ƒê·∫£m b·∫£o UX khi c√≥ timeout

## üéØ Frontend Integration

### Error Handling Components
1. **ErrorBoundary**
   ```jsx
   <ErrorBoundary fallback={<ErrorFallback />}>
     <App />
   </ErrorBoundary>
   ```

2. **LoadingSpinner**
   ```jsx
   {isLoading && (
     <div className="loading-spinner">
       <div className="spinner"></div>
       <span>ƒêang t·∫£i...</span>
     </div>
   )}
   ```

3. **ErrorFallback**
   ```jsx
   const ErrorFallback = ({ error, resetError }) => (
     <div className="error-container">
       <ServerIcon className="error-icon" />
       <h3>{error.title}</h3>
       <p>{error.message}</p>
       <button onClick={resetError}>Th·ª≠ l·∫°i</button>
     </div>
   );
   ```

### Toast Notifications
```jsx
// Success
toast.success("Thao t√°c th√†nh c√¥ng!");

// Error v·ªõi chi ti·∫øt
toast.error("L·ªói", {
  description: error.message,
  action: {
    label: "Th·ª≠ l·∫°i",
    onClick: () => retry()
  }
});
```

## üìö API Documentation

### Products API
- `GET /api/products` - L·∫•y danh s√°ch s·∫£n ph·∫©m
- `POST /api/products` - T·∫°o s·∫£n ph·∫©m m·ªõi
- `PUT /api/products/:id` - C·∫≠p nh·∫≠t s·∫£n ph·∫©m
- `DELETE /api/products/:id` - X√≥a s·∫£n ph·∫©m

### Orders API
- `GET /api/orders` - L·∫•y danh s√°ch ƒë∆°n h√†ng
- `POST /api/orders` - T·∫°o ƒë∆°n h√†ng m·ªõi
- `PUT /api/orders/:id` - C·∫≠p nh·∫≠t ƒë∆°n h√†ng
- `DELETE /api/orders/:id` - X√≥a ƒë∆°n h√†ng

### Customers API
- `GET /api/customers` - L·∫•y danh s√°ch kh√°ch h√†ng
- `POST /api/customers` - T·∫°o kh√°ch h√†ng m·ªõi
- `PUT /api/customers/:id` - C·∫≠p nh·∫≠t kh√°ch h√†ng
- `DELETE /api/customers/:id` - X√≥a kh√°ch h√†ng

## üîÑ Monitoring v√† Logging

### Frontend Monitoring
- Error tracking v√† reporting
- Performance metrics
- User behavior analytics

### Backend Monitoring
- Service health checks
- Resource utilization
- Error rates v√† latency

### Logging Strategy
- Request/Response logs
- Error stacks
- Performance metrics
- Circuit breaker state changes

## üöÄ H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t v√† ch·∫°y

### 1. Build & kh·ªüi ƒë·ªông v·ªõi Docker

```bash
docker-compose up --build
```

Sau khi ho√†n t·∫•t:
- API Gateway: http://localhost:5000
- Product Service: http://localhost:5001
- Order Service: http://localhost:5002
- Customer Service: http://localhost:5003
- MongoDB: ch·∫°y tr√™n c·ªïng 27017

> üí° Y√™u c·∫ßu: C√†i s·∫µn **Docker Desktop** v√† **Node.js** (n·∫øu kh√¥ng d√πng Docker)

### Development
```bash
npm run dev
```

### Production
```bash
npm run build
npm run start
```

## üéØ ƒê·ªãnh h∆∞·ªõng ph√°t tri·ªÉn

- ‚úÖ T·∫°o c·∫•u tr√∫c project v√† logic CRUD c∆° b·∫£n.
- ‚úÖ API Gateway ƒë·ªãnh tuy·∫øn ƒë·∫øn t·ª´ng service.
- ‚úÖ MongoDB ho·∫°t ƒë·ªông ·ªïn ƒë·ªãnh trong container ri√™ng bi·ªát.
- ‚è≥ T√≠ch h·ª£p frontend **React Vite**.
- ‚è≥ X√°c th·ª±c ng∆∞·ªùi d√πng v·ªõi JWT.
- ‚è≥ T√≠ch h·ª£p Kafka ho·∫∑c RabbitMQ ƒë·ªÉ truy·ªÅn th√¥ng tin gi·ªØa c√°c service (event-driven).
- ‚è≥ CI/CD v·ªõi GitHub Actions.

## üë• Th√¥ng tin

- **Sinh vi√™n th·ª±c hi·ªán**: Nguyen Duc Nhat
- **Email**: ducnhat0910@gmail.com
- **Th·ªùi gian th·ª±c hi·ªán**: Th√°ng 09/04/2025

## üìÑ License

MIT License - Copyright (c) 2024 Nguyen Duc Nhat

---

üì¨ *M·ªçi g√≥p √Ω ho·∫∑c h·ª£p t√°c xin g·ª≠i v·ªÅ: [ducnhat0910@gmail.com]*  
‚≠ê N·∫øu b·∫°n th·∫•y d·ª± √°n h·ªØu √≠ch, h√£y ‚≠ê repo n√†y nh√©!
